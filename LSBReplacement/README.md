# Лабораторная работа 2: Применение стеганографических методов для сокрытия информации

## Постановка задачи

Напишите программу для внедрения в файл 28.bmp и извлечения из него хеш-кода файла `leasing.txt`, полученного с помощью алгоритма SHA-1. Метод реализации – LSB Replacement. Номера байтов-контейнеров должны содержаться в предварительно сгенерированном ключе. С помощью сторонних приложений оцените объемы получившихся и исходного изображений.

## Описание решения

Метод `generateSHA1` для генерации хеш-кода SHA-1 файла принимает на вход путь к файлу и булево значение `print` (для определения необходимости вывода результата в консоль). В теле метода используется `ProcessBuilder`, аргументом которого будет являться команда для запуска командной строки Windows (`cmd.exe`) и запуска в ней утилиты `openssl`. Далее при помощи `InputStream` запущенного процесса получается результат выполнения команды, выводится в консоль (при необходимости) и в качестве результата возвращается хеш-код.

Кроме того, в программе будут использоваться три вспомогательных метода:

- `hexStringToByteArray(String hexString)` – переводит строку, записанную в 16-й системе счисления, в массив байтов. Используется для перевода хеш-кода из строки в массив байтов;
- `byteArrayToHexString(byte[] b)` – переводит массив байтов в строку, записанную в 16-й системе счисления. Используется для перевода извлеченного массива байтов в хеш-код;
- `generateKey(int count, int min, int max)` – генерирует целочисленных массив, где каждое значение – позиция байта bmp-файла, в которую будет встроен бит хеш-кода.

Определим необходимые переменные (количество встраиваемых/извлекаемых бит, размер заголовка BMP, массив для значений ключа) и опишем точку входа в программу. В методе `main` определяются переменные для хранения пути к файлам и сохраняется хеш-код исходного файла. В методе `embed` будет происходить внедрение хеш-кода в файл, а результат будет извлечен методом `extract` и сравнен с исходным методом `equals`.

Метод `embed` для встраивания сообщения в качестве аргументов принимает путь к входному/выходному файлам, а также строку с хеш-кодом.

1. В начале метода строка с хеш-кодом преобразуется в массив байтов, каждый байт которого будет представлен в двоичной системе счисления и записан в конец строки `hashBytesBinary`, которая в свою очередь будет преобразована в массив символов.
2. Далее считываются байты входного изображения, отдельно записывая заголовок и байты пикселей. На основе количества байт, отведенных на хранение пикселей, будет сгенерирован ключ длиной 160.
3. Далее срабатывает цикл `for` (160 итераций), который на каждой итерации извлекает соответствующий ключу байт изображения, записывает его в бинарном виде, переводит в массив символов и заменяет последний бит на бит двоичного представления хеш-кода. Байт изображения перезаписывается после внесенных изменений.
4. В конце метода происходит запись заголовка, а затем и пикселей в выходной bmp-файл.

Метод `extract` для извлечения сообщения из изображения в начале, аналогично предыдущему методу, совершает извлечение байтов из файла. Далее в цикле `for` (20 итераций) на каждой итерации будет инициализироваться массив для записи извлеченных битов. Во внутреннем цикле `for` (8 итераций) из соответствующего ключу байта будет извлекаться LSB и записываться в массив `charBitsArray`. После составления байта он переводится в 16-ю систему счисления и записывается в конец переменной `message`.

Визуально изменения не заметны, однако при просмотре через HEX-редактор можно обнаружить отличающиеся от нормы значения пикселей.
